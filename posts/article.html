<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">æ–‡ç« åŠ è½½ä¸­... - lxfight ä¸ªäººåšå®¢</title>
    <link rel="stylesheet" href="../styles.css">
    <!-- Markdown è§£æåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js"></script>
    <!-- ä»£ç é«˜äº®åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body class="modern-light-bg">
    <header>
        <nav>
            <div class="nav-container">
                <h1><a href="../index.html">lxfight</a></h1>
                <ul>
                    <li><a href="../index.html">é¦–é¡µ</a></li>
                    <li><a href="../about.html">å…³äºæˆ‘</a></li>
                    <li><a href="../blog.html">åšå®¢</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <article class="post-content">
            <div class="container">
                <!-- æ–‡ç« å…ƒä¿¡æ¯ä¼šç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                <header class="post-header" id="post-header">
                    <div class="loading-spinner">ğŸ“– æ–‡ç« åŠ è½½ä¸­...</div>
                </header>
                
                <!-- Markdownå†…å®¹ä¼šæ¸²æŸ“åˆ°è¿™é‡Œ -->
                <div class="post-body" id="post-body">
                    <div class="loading-content">
                        <p>æ­£åœ¨åŠ è½½æ–‡ç« å†…å®¹...</p>
                    </div>
                </div>
                
                <footer class="post-footer">
                    <p><a href="../blog.html">â† è¿”å›åšå®¢åˆ—è¡¨</a></p>
                </footer>
            </div>
        </article>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 lxfight ä¸ªäººåšå®¢. æ‰€æœ‰æƒåˆ©ä¿ç•™.</p>
        </div>
    </footer>

    <script>
        // é…ç½®markedé€‰é¡¹
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,
            gfm: true
        });

        // ä»URLå‚æ•°è·å–æ–‡ç« ID
        function getArticleId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || 'first-post';
        }

        // åŠ è½½å¹¶æ¸²æŸ“æ–‡ç« 
        async function loadArticle() {
            const articleId = getArticleId();
            
            try {
                // åŠ è½½æ–‡ç« é…ç½®
                const configResponse = await fetch(`../articles/${articleId}/config.json`);
                if (!configResponse.ok) {
                    throw new Error('æ–‡ç« é…ç½®åŠ è½½å¤±è´¥');
                }
                const config = await configResponse.json();

                // åŠ è½½Markdownå†…å®¹
                const contentResponse = await fetch(`../articles/${articleId}/content.md`);
                if (!contentResponse.ok) {
                    throw new Error('æ–‡ç« å†…å®¹åŠ è½½å¤±è´¥');
                }
                const markdown = await contentResponse.text();

                // æ¸²æŸ“æ–‡ç« 
                renderArticle(config, markdown);
                
            } catch (error) {
                console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);
                renderError(error.message);
            }
        }

        // æ¸²æŸ“æ–‡ç« å†…å®¹
        function renderArticle(config, markdown) {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.getElementById('page-title').textContent = `${config.title} - lxfight ä¸ªäººåšå®¢`;
            document.title = `${config.title} - lxfight ä¸ªäººåšå®¢`;

            // æ¸²æŸ“æ–‡ç« å¤´éƒ¨
            const headerHtml = `
                <h1>${config.title}</h1>
                <p class="post-meta">å‘å¸ƒäº ${config.date}${config.category ? ' | ' + config.category : ''}</p>
                ${config.tags ? `
                <div class="post-tags">
                    ${config.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                ` : ''}
            `;
            document.getElementById('post-header').innerHTML = headerHtml;

            // æ¸²æŸ“Markdownå†…å®¹
            const htmlContent = marked.parse(markdown);
            document.getElementById('post-body').innerHTML = htmlContent;

            // é«˜äº®ä»£ç å—
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });

            // æ·»åŠ å¤åˆ¶ä»£ç åŠŸèƒ½
            addCodeCopyButtons();
        }

        // æ¸²æŸ“é”™è¯¯ä¿¡æ¯
        function renderError(message) {
            document.getElementById('post-header').innerHTML = `
                <h1>æ–‡ç« åŠ è½½å¤±è´¥</h1>
                <p class="post-meta error">âŒ ${message}</p>
            `;
            document.getElementById('post-body').innerHTML = `
                <div class="error-content">
                    <p>æŠ±æ­‰ï¼Œæ— æ³•åŠ è½½æ­¤æ–‡ç« ã€‚å¯èƒ½çš„åŸå› ï¼š</p>
                    <ul>
                        <li>æ–‡ç« ä¸å­˜åœ¨æˆ–å·²è¢«ç§»åŠ¨</li>
                        <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
                        <li>æ–‡ä»¶æ ¼å¼é”™è¯¯</li>
                    </ul>
                    <p><a href="../blog.html">â† è¿”å›åšå®¢åˆ—è¡¨</a></p>
                </div>
            `;
        }

        // ä¸ºä»£ç å—æ·»åŠ å¤åˆ¶æŒ‰é’®
        function addCodeCopyButtons() {
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-code-btn';
                button.textContent = 'å¤åˆ¶';
                button.onclick = () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'å·²å¤åˆ¶!';
                        setTimeout(() => {
                            button.textContent = 'å¤åˆ¶';
                        }, 2000);
                    });
                };
                pre.appendChild(button);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', loadArticle);
    </script>
</body>
</html>